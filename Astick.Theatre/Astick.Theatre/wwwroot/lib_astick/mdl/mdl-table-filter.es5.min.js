"use strict";!function(n){var i=n.fn.mdlTable.utils.f_Sprintf,u=function(t){var i=t.$header;return t.options.height&&(i=n(t.el_TableHeaderCollumns)),i},f=function(n){var t=".headerCollumns select, .headerCollumns input";return n.options.height&&(t="table .headerCollumns select, table .headerCollumns input"),t},o=function(t){var i=u(t),r=f(t);t.m_FilterValues=[];i.find(r).each(function(){var i=n(this).parents("th").data("field");i!=null&&i!=""&&t.m_FilterValues.push({field:i,value:n(this).val()})})},e=function(t){var r=null,i=[],e=u(t),o=f(t);t.m_FilterValues.length>0&&e.find(o).each(function(){r=n(this).parents("th").data("field");i=n.grep(t.m_FilterValues,function(n){return n.field===r});i.length>0&&n(this).val(i[0].value)})},r=[],s=function(t,u){var h=!1,s,f,e=0,o;if(n.each(t.columns,function(e,o){var l,c,a,v,w,y,p,e,b;if(s="hidden",o.field_sys=o.field.replace(/\./,"_"),o.filterFieldItemKey===undefined&&(o.filterFieldItemKey=o.selectKey!==undefined?o.selectKey:"key"),o.filterFieldItemValue===undefined&&(o.filterFieldItemValue=o.selectValue!==undefined?o.selectValue:"value"),f=[],o.filterControl){f.push(i('<div style="margin: 0px 2px 2px 2px;" class="filterControl" type="%s">',o.filterControl.toLowerCase()));o.filterControl&&(h=!0,s="visible");l="";t.filterColumnsPartial!==undefined?(l=o.filterFieldKey!==undefined?t.filterColumnsPartial[o.filterFieldKey]:t.filterColumnsPartial[o.field],l==null&&(l="")):o.filterValue!==undefined&&(l=o.filterValue);switch(o.filterControl.toLowerCase()){case"input":f.push(i('<div class="mdl-textfield filter-keydown" style="width:80%;overflow:hidden;visibility: %s">',s)+i('<input class="mdl-textfield__input" type="text" style="width:100%" id="%s_filter_%s" value="%s" />',t.m_ID,o.field_sys,l)+i('<label class="mdl-textfield__label" for="%s_filter_%s"><\/label>',t.m_ID,o.field_sys)+"<\/div>");break;case"select":o.filterFieldKey===undefined&&(o.filterFieldKey=o.filterFieldItemKey);f.push(i('<div class="mdl-selectfield filter-select %s" data-field-item-key="%s" data-field-item-value="%s"><input id="%s_filter_select_%s" class="mdl-selectfield__input" data-read-only="true" />',o.field_sys,o.filterFieldItemKey,o.filterFieldItemValue,t.m_ID,o.field_sys)+i('<label class="mdl-selectfield__label" for="%s_filter_select_%s"><\/label>',t.m_ID,o.field_sys)+i('<ul for="%s_filter_select_%s"><\/ul><\/div>',t.m_ID,o.field_sys));break;case"datepicker":f.push(i('<div class="mdl-datefield filter-date"><input id="%s_filter_date_%s" class="%s mdl-datefield__input" style="width: 100%; visibility: %s" value="%s"><\/input>',t.m_ID,o.field_sys,o.field_sys,s,l)+i('<label class="mdl-datefield__label" for="%s_filter_date_%s"><\/label>',t.m_ID,o.field_sys)+"<\/div>")}}if([].forEach.call(u.children,function(n){var i,t;if(n.getAttribute("data-field")===o.field){if(i=n.querySelector(".fht-cell"),i!=null&&(n.querySelector(".fht-cell").innerHTML=f.join("")),o.filterControl)switch(o.filterControl.toLowerCase()){case"input":t=n.querySelector(".mdl-textfield");componentHandler.upgradeElement(n.querySelector(".mdl-textfield"),"MaterialTextfield");break;case"select":t=n.querySelector(".mdl-selectfield");componentHandler.upgradeElement(t,"MaterialSelectfield");break;case"datepicker":t=n.querySelector(".mdl-datefield");componentHandler.upgradeElement(n.querySelector(".mdl-datefield"),"MaterialDatefield")}return!1}}),o.filterData===undefined&&o.selectDataValue!==undefined&&(o.selectDataType==="var"||o.selectDataType==="url")&&(o.filterData=o.selectDataType+"="+o.selectDataValue),(o.selectDataType==="enum"||o.filterData!==undefined&&o.filterData.toLowerCase()!=="column")&&(c=t.el_Table.querySelector("."+o.field_sys),c!==null))if(c=c.MaterialSelectfield,o.filterReadOnly&&(c.options.readOnly=!0),o.selectDataType==="enum"){a={};a.key=-1;a.value=t.options.formatAllRows();v=[a];for(e in o.selectData)a={},a.key=e,a.value=o.selectData[e],v.push(a);c.f_SetData(v);c.options.searchMinLength=1;c.options.searchMethod="local";c.f_SetKey(l)}else{w=o.filterData.substring(0,3);y=o.filterData.substring(4,o.filterData.length);o.filterFieldKey!==undefined&&(c.m_FieldKey=o.filterFieldKey);o.filterFieldValue!==undefined&&(c.m_FieldValue=o.filterFieldValue);switch(w){case"url":p=!1;for(e in r)if(r[e][0]==o.field){c.f_SetData(r[e][1]);p=!0;break}p||n.ajax({url:y,dataType:"json",success:function(n){var t={};t.value="";n.splice(0,0,t);c.f_SetData(n);r.push([o.field,n])}});break;case"var":b=window[y];c.f_SetData(b);c.options.searchMinLength=1;c.options.searchMethod="local"}c!=null&&c.f_SetKey(l)}}),o=n(u),h){o.off("keydown",".filter-keydown input").on("keydown",".filter-keydown input",function(n){t.options.filterSubmit&&n.keyCode!=null?n.keyCode=="13"&&(t.f_OnColumnSearch(n),n.preventDefault()):n.keyCode=="13"?n.preventDefault():(n.keyCode===8||n.keyCode===32||n.keyCode>=45&&n.keyCode<=90||n.keyCode>=96&&n.keyCode<=111||n.keyCode>=186&&n.keyCode<=192)&&(clearTimeout(e),e=setTimeout(function(){t.f_OnColumnSearch(n)},t.options.searchTimeOut))});o.find(".filter-select input").off("change").on("change",function(n){t.options.filterSubmit?t.f_OnColumnSearch(n):(clearTimeout(e),e=setTimeout(function(){t.f_OnColumnSearch(n)},t.options.searchTimeOut))});o.find(".filter-date .mdl-datefield__input").off("afterChange").on("afterChange",function(n){clearTimeout(e);e=setTimeout(function(){t.f_OnColumnSearch(n)},t.options.searchTimeOut)})}else o.find(".filterControl").hide()};n.extend(n.fn.mdlTable.defaults,{filterControl:!1,filterSubmit:!1,searchTimeOut:500,f_OnColumnSearch:function(){return!1},showFilterClear:!1,filterIcons:{clear:"flash_off"}});n.extend(n.fn.mdlTable.COLUMN_DEFAULTS,{filterControl:undefined,filterReadOnly:!1,filterValue:undefined,filterFieldKey:undefined,filterFieldName:undefined,filterFieldValue:undefined,filterFieldValueTemplate:undefined,filterFieldItemKey:undefined,filterFieldItemValue:undefined,filterFieldItemValueTemplate:undefined});n.extend(n.fn.mdlTable.Constructor.EVENTS,{"column-search.mdl.table":"f_OnColumnSearch"});var t=n.fn.mdlTable.Constructor,h=t.prototype.f_Init,c=t.prototype.f_InitToolbar,l=t.prototype.f_InitHeader,a=t.prototype.f_InitBody,y=t.prototype.f_InitSearch;t.prototype.f_Init=function(){if(this.options.filterControl){var n=this;this.m_FilterValues=[];this.$el.on("reset-view.mdl.table",function(){n.options.height&&(n.el_TableHeaderCollumns.querySelectorAll("select").length>0||n.el_TableHeaderCollumns.querySelectorAll("input").length>0||s(n,n.el_TableHeaderCollumns))}).on("post-header.mdl.table",function(){e(n)}).on("column-switch.mdl.table",function(){e(n)})}h.apply(this,Array.prototype.slice.apply(arguments))};t.prototype.f_InitToolbar=function(){if(!this.showToolbar&&this.options.filterControl&&(this.showToolbar=this.options.filterControl),c.apply(this,Array.prototype.slice.apply(arguments)),this.options.filterControl&&this.options.showFilterClear){var r=this.$toolbarButtons.find(".btnUser"),t=n([i('<div title="%s">',this.options.formatFilterClear()),'<button class="mdl-button mdl-js-button mdl-button--icon" type="button" name="filterclear">',i('<i class="material-icons">%s<\/i>',this.options.filterIcons.clear),"<\/button><\/div>"].join(""));r.length>0?r.before(t):t.appendTo(this.$toolbarButtons);t.off("click").on("click",n.proxy(this.f_ClearFilterControl,this))}};t.prototype.f_InitHeader=function(){var t=this;(componentHandler.downgradeElements(this.el_Header.querySelectorAll("tr .fht-cell .mdl-textfield, tr .fht-cell .mdl-selectfield, tr .fht-cell .mdl-datefield")),l.apply(this,Array.prototype.slice.apply(arguments)),this.options.filterControl)&&(s(this,this.el_TableHeaderCollumns),o(this),this.filterColumnsPartial={},n.each(this.m_FilterValues,function(n,i){i.field!==undefined&&i.field!==null&&i.field!==""&&i.value!==undefined&&i.value!==null&&i.value!==""&&(t.filterColumnsPartial[i.field]=i.value)}))};t.prototype.f_InitBody=function(){var i,r;a.apply(this,Array.prototype.slice.apply(arguments));var t=this,u=this.options.data,f=this.pageTo<this.options.data.length?this.options.data.length:this.pageTo;for(i=this.pageFrom-1;i<f;i++)r=u[i],n.each(this.header.fields,function(u,f){var s=r[f],e=t.columns[t.f_GetFieldIndex(t.columns,f)],o,h;s=n.fn.mdlTable.utils.calculateObjectValue(t.header,t.header.formatters[u],[s,r,i],s);e.checkbox&&e.radio||e.filterControl!==undefined&&e.filterControl.toLowerCase()==="select"&&(e.filterData===undefined||e.filterData.toLowerCase()==="column")&&(o=n("."+e.field),o!==undefined&&o.length>0&&(h=o.get(o.length-1).options,h!==undefined&&(h.length===0&&addOptionToSelectControl(o,"",""),addOptionToSelectControl(o,s,s))))})};t.prototype.f_ColumnSearch=function(t,i,r){var f,u;t!==undefined&&t!==null&&(f=this,o(this),u="",i!==undefined&&i!==null&&(u=i),n.isEmptyObject(this.filterColumnsPartial)&&(this.filterColumnsPartial={}),u!==undefined&&u!==null&&u!==""?this.filterColumnsPartial[t]=u:delete this.filterColumnsPartial[t],this.options.pageNumber=1,this.f_InitServer(null,null,function(){r!==undefined&&r();f.f_Trigger("column-search",t,u)}))};t.prototype.f_OnColumnSearch=function(t,i){var r=t.target.getAttribute("key"),u,f,e;r===null?r=t.target.value:r==="undefined"&&(r="");u=r;t.target.getAttribute("type")==="number"&&u!==""&&(u=parseInt(r),u===NaN&&(u=r));f=undefined;e=n(t.currentTarget).parents("th").data("filterFieldKey");f=e!==undefined?e:n(t.currentTarget).parents("th").data("field");this.f_ColumnSearch(f,u,i)};t.prototype.f_ClearFilterControl=function(){var t,r,i;this.options.filterControl&&this.options.showFilterClear&&(t=this,n.each(this.m_FilterValues,function(n,t){t.value=""}),e(this),r=u(this).find(f(this)),i=0,r.length>0&&(this.filterColumnsPartial={},clearTimeout(i),i=setTimeout(function(){t.options.pageNumber=1;t.f_InitServer()},this.options.searchTimeOut)))}}(jQuery);