"use strict";!function(n){var t=n.fn.mdlTable.Constructor;t.f_OnWindowResize=function(){window.innerWidth<840?this.m_CardView||(this.m_CardView=!0,this.f_InitCardView()):this.m_CardView&&(this.m_CardView=!1,this.f_InitCardView())};t.prototype.f_GetChecked=function(){return this.options.checked||this.options.showActionSelected||this.options.showRemoveSelected};t.prototype.f_GetTotals=function(){return this.options.totalFields!==undefined&&this.options.totalFields.length>0};t.prototype.f_Init=function(){this.e_OnWindowResize=t.f_OnWindowResize.bind(this);window.removeEventListener("resize",this.e_OnWindowResize);window.addEventListener("resize",this.e_OnWindowResize);this.m_IsLoaded=!1;this.m_CardView=window.innerWidth<768;this.f_InitLocale();this.f_InitContainer();this.f_InitLoader();this.f_InitTable();this.f_InitData(this.options.data);this.f_InitCardView();this.f_InitServer();this.f_InitRowsColors();this.f_InitSnackbar()};t.prototype.f_InitLocale=function(){if(this.options.locale){var t=this.options.locale.split(/-|_/);t[0].toLowerCase();t[1]&&t[1].toUpperCase();n.fn.mdlTable.locales[this.options.locale]?n.extend(this.options,n.fn.mdlTable.locales[this.options.locale]):n.fn.mdlTable.locales[t.join("-")]?n.extend(this.options,n.fn.mdlTable.locales[t.join("-")]):n.fn.mdlTable.locales[t[0]]&&n.extend(this.options,n.fn.mdlTable.locales[t[0]])}};t.prototype.f_InitContainer=function(){this.el_Container=document.createElement("form");this.el_Container.classList.add("mdl-table","mdl-color-text--grey-600");this.options.widthfill&&this.el_Container.classList.add("mdl-table-widthfill");this.el_Container.setAttribute("onsubmit","return false;");this.el_Table.parentNode.insertBefore(this.el_Container,this.el_Table);this.el_Container.appendChild(this.el_Table);Cl_Core.f_AddClasses(this.el_Table,this.options.classes);this.$container=n(this.el_Container)};t.prototype.f_InitLoader=function(){this.el_CardViewLoader=document.createElement("div");this.el_CardViewLoader.classList.add("mdl-table_cardView-loader");this.el_CardViewLoader.innerHTML=['<div class="mdl-spinner mdl-js-spinner is-active"><\/div>'];this.el_Container.appendChild(this.el_CardViewLoader)};t.prototype.f_InitTable=function(){var i=this,r=[],u=[];(this.$header=this.$el.find(">thead"),this.$header.length||(this.$header=n("<thead><\/thead>").appendTo(this.$el)),this.el_Header=this.$header[0],this.$header.find("tr").each(function(){var t=[];n(this).find("th").each(function(){t.push(n.extend({},{title:n(this).html(),"class":n(this).attr("class"),titleTooltip:n(this).attr("title"),rowspan:n(this).attr("rowspan")?+n(this).attr("rowspan"):undefined,colspan:n(this).attr("colspan")?+n(this).attr("colspan"):undefined},n(this).data()))});r.push(t)}),n.isArray(this.options.columns[0])||(this.options.columns=[this.options.columns]),this.options.columns=n.extend(!0,[],r,this.options.columns),this.columns=[],this.f_SetFieldIndex(this.options.columns),n.each(this.options.columns,function(r,u){n.each(u,function(u,f){if(f=n.extend({},t.COLUMN_DEFAULTS,f),typeof f.fieldIndex!="undefined"&&(i.columns[f.fieldIndex]=f),f.selectDataValue!=null&&typeof f.selectDataValue=="string")if(f.selectDataType==="var")f.selectData=Cl_Core.f_GetPropByString(window,f.selectDataValue);else if(f.selectDataType==="json")f.selectData=JSON.parse(f.selectDataValue.replace(/'/g,'"'));else if(f.selectDataType==="url")f.selectData=JSON.parse(f.selectDataValue.replace(/'/g,'"'));else if(f.selectDataType==="enum"){var e=JSON.parse(f.selectDataValue.replace(/'/g,'"'));f.selectField=f.field;f.selectData=Object.keys(e).map(function(n){return e[n]})}else f.selectData=undefined;i.options.columns[r][u]=f})}),this.options.data==null||this.options.data.length)||(this.$el.find(">tbody>tr").each(function(){var t={};t._id=n(this).attr("id");t._class=n(this).attr("class");t._data=Cl_Core.f_GetRealDataAttr(n(this).data());n(this).find("td").each(function(r){var u=i.columns[r].field;t[u]=n(this).html();t["_"+u+"_id"]=n(this).attr("id");t["_"+u+"_class"]=n(this).attr("class");t["_"+u+"_rowspan"]=n(this).attr("rowspan");t["_"+u+"_title"]=n(this).attr("title");t["_"+u+"_data"]=Cl_Core.f_GetRealDataAttr(n(this).data())});u.push(t)}),this.options.data=u)};t.prototype.f_InitHeader=function(){var t=this,f={},i=[],r=[],u;this.header={fields:[],styles:[],classes:[],formatters:[],events:[],sorters:[],sortNames:[],cellStyles:[],stateField:"selected"};n.each(this.options.columns,function(u,e){var o=e.length;t.f_GetChecked()&&o++;t.options.numbering&&o++;(t.options.detailSub||t.options.detailView)&&o++;t.options.showReview&&o++;t.options.showClone&&o++;t.options.showEdit&&o++;t.options.showRemove&&o++;i.push(Cl_Core.f_Sprintf('<tr class="headerButtons"><th colspan="%s" class="mdl-table-toolbar"><div class="mdl-table-toolbar-selectTitle"><\/div><div class="mdl-table-toolbar-buttons"><\/div><\/th><\/tr>',o));i.push(Cl_Core.f_Sprintf('<tr class="headerLoader"><th colspan="%s" class="mdl-table-loader"><div class="mdl-progress mdl-js-progress mdl-progress__indeterminate"><\/div><\/th><\/tr>',o));i.push('<tr class="headerCollumns">');t.f_GetTotals()&&r.push('<tr class="headerTotals">');t.f_GetChecked()&&(t.options.singleSelect?i.push('<th class="cbx"><\/th>'):i.push(Cl_Core.f_Sprintf('<th class="cbx"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="%s_chbxCheckAll"><input name="bSelectAll" type="checkbox" id="%s_chbxCheckAll" class="mdl-checkbox__input mdl-checkbox__input-all"><span class="mdl-checkbox__label"><\/span><\/label><\/th>',t.m_ID,t.m_ID)),r.push('<th class="cbx"><\/th>'));t.options.numbering&&(i.push('<th class="table_row_numbering">№<\/th>'),r.push('<th class="table_row_numbering">&nbsp<\/th>'));(t.options.detailSub||t.options.detailView)&&(i.push('<th class="detail"><\/th>'),r.push('<th class="detail"><\/th>'));n.each(e,function(n,u){var l,a,p;if(typeof u.fieldIndex!="undefined"&&(t.header.fields[u.fieldIndex]=u.field),u.type==="array"&&(u.cardArea=3),u.type!=="button"&&u.type!=="hidden"){var s="",v="",h="",e="",y=Cl_Core.f_Sprintf(' class="%s"',u["class"]),w=t.options.sortOrder||u.order,c="px",o=u.width;if(u.width===undefined||t.m_CardView||typeof u.width=="string"&&u.width.indexOf("%")!==-1&&(c="%"),u.width&&typeof u.width=="string"&&(o=u.width.replace("%","").replace("px","")),v=Cl_Core.f_Sprintf("text-align: %s; ",u.halign?u.halign:u.align),h=Cl_Core.f_Sprintf("text-align: %s; ",u.align),e=Cl_Core.f_Sprintf("vertical-align: %s; ",u.valign),e+=Cl_Core.f_Sprintf("width: %s; min-width: %s; ",o?o+c:undefined,o?o+c:undefined),typeof u.fieldIndex!="undefined"){if(t.header.fields[u.fieldIndex]=u.field,t.header.styles[u.fieldIndex]=t.m_CardView&&!t.f_GetVisible(u)?h+e+"display: none; ":h+e,t.header.classes[u.fieldIndex]=y,t.header.formatters[u.fieldIndex]=u.formatter,t.header.events[u.fieldIndex]=u.events,t.header.sorters[u.fieldIndex]=u.sorter,t.header.sortNames[u.fieldIndex]=u.sortName,t.header.cellStyles[u.fieldIndex]=u.cellStyle,t.m_CardView&&!t.f_GetCardEnabled(u))return;f[u.field]=u}if(t.f_GetVisible(u)||(e+="display: none;"),l=["<th"+Cl_Core.f_Sprintf(' title="%s"',u.titleTooltip),y,Cl_Core.f_Sprintf(' style="%s"',v+e),Cl_Core.f_Sprintf(' rowspan="%s"',u.rowspan),Cl_Core.f_Sprintf(' colspan="%s"',u.colspan),Cl_Core.f_Sprintf(' data-field="%s"',u.field)," tabindex='0'",">"].join(""),i.push(l),t.f_GetTotals()){r.push(l);a=t.options.totalFields.split(",");for(p in a)if(a[p]===u.field){r.push('<span class="totalSumIcon">Ʃ <\/span><span class="totalSumVal" data-field="'+u.field+'">0<\/span>');break}}i.push(Cl_Core.f_Sprintf('<div class="th-inner %s">',t.options.sortable&&u.sortable?"sortable both":""));t.options.sortable&&u.sortable&&i.push('<i class="material-icons"><\/i>');s=u.title;i.push(Cl_Core.f_Sprintf('<span class="firstWord">%s<\/span><span>%s%s<\/span>',s[0],s.substring(1,s.length),u.unit!=null?", <br/>"+u.unit:""));i.push("<\/div>");i.push('<div class="fht-cell"><\/div>');i.push("<\/div>");i.push("<\/th>");r.push("<\/th>")}});t.f_IsVisibleButtons()&&(i.push('<th class="btns btnsRows"><\/th>'),r.push('<th class="btns btnsRows"><\/th>'));i.push("<\/tr>");r.push("<\/tr>")});t.f_GetTotals()?this.$header.html(i.join("")+r.join("")):this.$header.html(i.join(""));this.$header.find("th[data-field]").each(function(){n(this).data(f[n(this).data("field")])});this.$container.off("click",".th-inner").on("click",".th-inner",function(i){t.options.sortable&&n(this).parent().data().sortable&&t.f_OnSort(i)});this.el_TableHeaderButtons=this.el_Table.querySelector(".headerButtons");this.el_TableHeaderCollumns=this.el_Table.querySelector(".headerCollumns");t.f_GetTotals()&&(this.el_TableHeaderTotals=this.el_Table.querySelector(".headerTotals"));this.el_TableHeaderLoader=this.el_Table.querySelector(".headerLoader");this.f_HideLoading();this.el_Toolbar=this.el_TableHeaderButtons.querySelector(".mdl-table-toolbar");this.el_ToolbarButtons=this.el_Toolbar.querySelector(".mdl-table-toolbar-buttons");this.el_ToolbarSelectTitle=this.el_TableHeaderButtons.querySelector(".mdl-table-toolbar-selectTitle");this.$toolbar=n(this.el_Toolbar);this.$toolbarButtons=n(this.el_ToolbarButtons);this.$toolbarSelectTitle=n(this.el_ToolbarSelectTitle);!this.options.showHeader||this.m_CardView?(this.el_TableHeaderCollumns.classList.add("hidden"),this.el_TableHeaderTotals!==undefined&&this.el_TableHeaderTotals.classList.add("hidden"),this.el_TableHeaderLoader.classList.add("hidden")):(this.el_TableHeaderCollumns.classList.remove("hidden"),this.el_TableHeaderTotals!==undefined&&this.el_TableHeaderTotals.classList.remove("hidden"),this.f_UpdateCaret());componentHandler.upgradeElement(this.el_TableHeaderLoader.querySelector(".mdl-progress"),"MaterialProgress");this.$container.off("click",'[name="bSelectAll"]').on("click",'[name="bSelectAll"]',function(){var i=n(this).prop("checked");t[i?"f_CheckAll":"f_UncheckAll"]();t.f_UpdateSelected();i?t.f_Trigger("check-change",t.data,n(this)):t.f_Trigger("check-change",null,n(this))});this.f_InitToolbar();t.f_GetChecked()&&!t.options.singleSelect&&(u=this.$header.find('[name="bSelectAll"]').parent()[0],componentHandler.upgradeElement(u,"MaterialCheckbox"),this.ctrl_SelectAll=u.MaterialCheckbox)};t.prototype.f_InitData=function(n,t){var r=this,i;this.options.url||this.options.ajax||n!=null?(this.data=t==="append"?this.data.concat(n):t==="prepend"?[].concat(n).concat(this.data):n==null?[]:n,this.options.data=t==="append"?this.options.data.concat(n):t==="prepend"?[].concat(n).concat(this.options.data):this.data):(i=[],i.total=0,this.options.data=i,this.data=i)};t.prototype.f_InitDataTotals=function(n){this.dataTotals=n};t.prototype.f_InitSnackbar=function(){if(this.options.visibleSnackbar){var n=document.getElementsByClassName("mdl-snackbar");n!==undefined&&n.length>0?this.el_Snackbar=n[0]:(this.el_Snackbar=document.createElement("div"),this.el_Snackbar.classList.add("mdl-snackbar"),this.el_Snackbar.innerHTML='<div class="mdl-snackbar__text"><\/div><button class="mdl-snackbar__action" type= "button" ><\/button>',this.el_Container.appendChild(this.el_Snackbar),componentHandler.upgradeElement(this.el_Snackbar,"MaterialSnackbar"))}};t.prototype.f_OnSort=function(t){var i=t.type==="keypress"?n(t.currentTarget):n(t.currentTarget).parent(),r=this.$header.find("th").eq(i.index());this.$header.add(this.$header_).find("span.order").remove();this.options.sortName===i.data("field")?this.options.sortOrder=this.options.sortOrder==="asc"?"desc":"asc":(this.options.sortName=i.data("field"),this.options.sortOrder="asc");this.f_Trigger("sort",this.options.sortName,this.options.sortOrder);i.add(r).data("order",this.options.sortOrder);this.f_UpdateCaret();this.options.pageNumber=1;this.f_InitServer(this.options.silentSort)};t.prototype.f_OnError=function(n){this.f_Trigger("error",n);this.options.errorEnabled&&(this.options.errorAction!==undefined?Cl_Core.f_CalculateObjectValue(null,this.options.errorAction,[this,n],""):n.msg!==undefined?alert(n.msg):n.errmsg!==undefined?alert(n.errmsg):alert(n))};t.prototype.f_GetVisible=function(n){return!n.hidden&&n.visible&&!n.addOnly&&!n.editOnly&&n.type!=="hidden"};t.prototype.f_GetCardEnabled=function(n){return n.cardEnabled&&!n.addOnly&&!n.editOnly};t.prototype.f_GetSwitchable=function(n){return n.switchable&&n.type!=="hidden"&&!n.addOnly&&!n.editOnly};t.prototype.f_InitToolbar=function(){var t=this,i=[],u=0;if(this.$toolbarButtons.html(""),typeof this.options.icons=="string"&&(this.options.icons=Cl_Core.f_CalculateObjectValue(null,this.options.icons)),t.options.showAdd&&i.push(this.f_GetBtnAdd()),this.options.showRemoveSelected?i.push(this.f_GetBtnRemoveSelected()):this.options.showActionSelected&&i.push(this.f_GetBtnActionSelected()),this.options.showRefresh&&i.push(this.f_GetBtnRefresh()),this.f_GetShowingColumns()&&(i.push(Cl_Core.f_Sprintf('<div title="%s" class="columns">',this.options.formatColumns()),Cl_Core.f_Sprintf('<button id="%s_bcolumns" type="button" class="mdl-button mdl-js-button mdl-button--icon" title="%s">',this.m_ID,this.options.formatColumns()),Cl_Core.f_Sprintf('<i class="material-icons">%s<\/i>',t.options.icons.columns),"<\/button>",Cl_Core.f_Sprintf('<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="%s_bcolumns">',this.m_ID)),n.each(this.columns,function(n,r){if(t.f_GetSwitchable(r)&&r.type!=="button"){var e=t.f_GetVisible(r)?' checked="checked"':"",f=r.title;r.title.indexOf(",")>0&&(f=f.substring(0,f.indexOf(",")));i.push(Cl_Core.f_Sprintf('<li class="mdl-menu__item"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="%s_chbx%s"><input type="checkbox" id="%s_chbx%s" class="mdl-checkbox__input" data-field="%s" value="%s"%s/><span class="mdl-checkbox__label">%s<\/span><\/label><\/li>',t.m_ID,n,t.m_ID,n,r.field,n,e,f));u++}}),i.push("<\/ul>","<\/div>")),this.options.toolbarExtraButtons!=null&&this.options.toolbarExtraButtons!==""&&n.each(this.options.toolbarExtraButtons,function(n,t){i.push('<div class="btnUser">'+t+"<\/div>")}),this.options.showToolbar||i.length>0?(this.$toolbarButtons.append(i.join("")),this.$toolbar.removeClass("hidden")):this.$toolbar.addClass("hidden"),this.options.showRefresh){this.$toolbarBRefresh=this.$toolbarButtons.find('button[name="bRefresh"]');this.$toolbarBRefresh.off("click").on("click",n.proxy(this.f_Refresh,this))}if(this.options.showAdd){this.$toolbarBAdd=this.$toolbarButtons.find('button[name="bAdd"]');this.$toolbarBAdd.off("click").on("click",n.proxy(this.f_Add,this))}if(this.options.showRemoveSelected){this.$toolbarBActionSelected=this.$toolbarButtons.find('button[name="bRemoveSelected"]');this.$toolbarBActionSelected.off("click").on("click",n.proxy(this.f_RemoveSelected,this))}if(this.options.showActionSelected){this.$toolbarBActionSelected=this.$toolbarButtons.find('button[name="bActionSelected"]');this.$toolbarBActionSelected.off("click").on("click",n.proxy(this.f_ActionSelected,this))}if(this.f_GetShowingColumns()){u<=this.options.minimumCountColumns&&(this.el_ToolbarButtons.querySelector("input").disabled=!0);var f=function(){setTimeout(function(){var n=this;t.f_ToggleColumn(t.f_GetFieldIndex(t.columns,n.getAttribute("data-field")),n.checked,!1);t.f_Trigger("column-switch",n.getAttribute("data-field"),n.checked)}.bind(this),500)},e=function(){var n,t;event.srcElement.classList.contains("mdl-menu__item")&&(n=this.querySelector("input"),n.checked=!n.checked,t=document.createEvent("Event"),t.initEvent("change",!0,!0),n.dispatchEvent(t))},r=this.el_ToolbarButtons.querySelectorAll("li.mdl-menu__item");[].forEach.call(r,function(n){n.removeEventListener("click",e);n.addEventListener("click",e)});r=this.el_ToolbarButtons.querySelectorAll("li.mdl-menu__item input");[].forEach.call(r,function(n){n.removeEventListener("change",f);n.addEventListener("change",f)});componentHandler.upgradeElement(this.$toolbarButtons.find(".mdl-menu")[0],"MaterialMenu");componentHandler.upgradeDom(this.$toolbar[0],"MaterialCheckbox")}};t.prototype.f_InitButtonsFromContent=function(t){if(t!=null){t.find('[name="bReview"]').off("click").on("click",n.proxy(this.f_Review,this));t.find('[name="bAdd"]').off("click").on("click",n.proxy(this.f_Add,this));t.find('[name="bClone"]').off("click").on("click",n.proxy(this.f_Clone,this));t.find('[name="bEdit"]').off("click").on("click",n.proxy(this.f_Edit,this));t.find('[name="bRemove"]').off("click").on("click",n.proxy(this.f_Remove,this));t.find('[name="bSubDetail"]').off("click").on("click",n.proxy(this.f_SubDetail,this));t.find('[name="bDetail"]').off("click").on("click",n.proxy(this.f_Detail,this));t.find('[name="bRefresh"]').off("click").on("click",n.proxy(this.f_Refresh,this))}};t.prototype.f_InitToolbarRows=function(){this.f_InitButtonsFromContent(this.$body)};t.prototype.f_InitRowsColors=function(t){var i,r,e,u,o,f;this.options.rowColors!=null&&(i=this,r="color",i.m_CardView?r="border-left-color":this.options.rowColorsStyle==="background"&&(r="background-color"),u=0,t!=null&&t.hasClass("mdl-table_row")?(e=t,u=t.attr("data-index")):e=this.$body.find("> tr.mdl-table_row"),this.options.rowColorsType==="var"?(o=this.options.rowColors,e.each(function(){var s=n(this),f,t,h,c,e;f=i.m_CardView?n(this.children[0]):s;t=Cl_Core.f_GetPropByString(i.f_GetRowDataFromIndex(u),o);t!==undefined&&t!==""&&(h=function(n){var t=(n>>24&255).toString(16)+(n>>16&255).toString(16)+(n>>8&255).toString(16)+(n&255).toString(16);return t+="000000",t.substring(0,6)},c=10,t=parseInt(parseInt(t)/c),t>0&&(t=255e5/t),e="#"+h(t),f.css(r,e),s.addClass("mdl-table_row_color"),i.m_CardView&&n(".mdl-table-card_color",f).css("color",e));u++})):this.options.rowColorsType==="json"&&(f=JSON.parse(this.options.rowColors.replace(/'/g,'"')),e.each(function(){var l=!1,t,e,h,o,c,a,s;for(t in f){e=Cl_Core.f_GetPropByString(i.f_GetRowDataFromIndex(u),t);h=n(this);o=i.m_CardView?n(this.children[0]):h;for(c in f[t])if(a=c.split(","),a.indexOf(e)>-1){e=c;break}f[t][e]!=null?(s=f[t][e],i.m_CardView&&(s=s.replace("0.","1.")),o.css(r,s),h.addClass("mdl-table_row_color"),l=!0,i.m_CardView&&n(".mdl-table-card_color",o).css("color",s)):l||(o.css(r,""),h.removeClass("mdl-table_row_color"),i.m_CardView&&n(".mdl-table-card_color",o).css("color",""))}u++})))};t.prototype.f_InitButtonsRows=function(t,i,r){var f=this,u=t;u==null&&(u=this.$body);u.find('[name="bAction"]').off("click").on("click",function(){var o=n(this),t=i,e=r,u;t==null&&(t=o.closest("tr.mdl-table_row").attr("data-index"));e==null&&(e=f.f_GetRowDataFromIndex(t));u=o.attr("data-action");u!=null&&u!==""&&Cl_Core.f_CalculateObjectValue(null,u,[f,t,e],"")});this.f_InitButtonsFromContent(u)};t.prototype.onPageListChange=function(t){var i=n(t.currentTarget);i.parent().addClass("active").siblings().removeClass("active")};t.prototype.onPageFirst=function(){this.options.pageNumber=1};t.prototype.onPagePre=function(){this.options.pageNumber--};t.prototype.onPageNext=function(){this.options.pageNumber++};t.prototype.onPageLast=function(){this.options.pageNumber=this.totalPages};t.prototype.onPageNumber=function(t){this.options.pageNumber!==+n(t.currentTarget).text()&&(this.options.pageNumber=+n(t.currentTarget).text())};t.prototype.f_InitChecked=function(t){if(this.f_GetChecked()){var i=this,r=[],u=t;u==null&&(u=this.$body);u.find(Cl_Core.f_Sprintf('input[name="%s"]',this.options.selectItemName)).each(function(){componentHandler.upgradeElement(this.parentNode,"MaterialCheckbox");r.push(this.parentNode.MaterialCheckbox)}).off("change").on("change",function(t){t.stopImmediatePropagation();var u=n(this),f=u.data("index"),r=i.data[f];r[i.header.stateField]=this.checked;i.options.singleSelect&&(i.$selectItem.not(this).each(function(){r[i.header.stateField]=!1}),i.$selectItem.filter(":checked").not(this).prop("checked",!1));i.f_UpdateSelected();i.f_Trigger("check-change",r,u);i.f_Trigger(this.checked?"check":"uncheck",r,u)});t==null?i.ctrl_SelectItems=r:i.ctrl_SelectItems.push(r);this.$selectItem=this.$body.find(Cl_Core.f_Sprintf('[name="%s"]',this.options.selectItemName))}};t.prototype.f_InitSelectColumns=function(t){var i=this,u=null,r="";this.m_CardView&&(r=".mdl-table_row_panelCard");u=t==null?this.$body.find("> tr[data-index] > td"+r):t.find("> td"+r);u.off("click dblclick").on("click dblclick",function(t){var r=n(this),u=r.parent(),f=u.data("index"),e=i.data[f],h=r[0].cellIndex,o=i.header.fields[(i.options.detailSub||i.options.detailView||i.f_GetChecked()||i.options.numbering)&&!i.m_CardView?h-1:h],c=i.f_GetColumn(o),l=Cl_Core.f_GetItemField(e,o),s;r.find(".detail-icon").length||(i.m_CardView&&i.options.cardReviewAuto&&n(t.target).parents('[name="bAction"]').length===0&&i.f_Open(t),i.f_Trigger(t.type==="click"?"click-cell":"dbl-click-cell",i,o,l,f,e,r),i.f_Trigger(t.type==="click"?"click-row":"dbl-click-row",i,f,e,u),t.type==="click"&&i.options.clickToSelect&&c.clickToSelect&&(s=u.find(Cl_Core.f_Sprintf('[name="%s"]',i.options.selectItemName)),s.length&&s[0].click()))})};t.prototype.f_InitDetail=function(t){var i=this,r=this.f_GetData(),u=t==null?this.$body.find("> tr[data-index] > td > .detail-icon"):t.find("> td >.detail-icon");u.off("click").on("click",function(){var s=n(this),t=s.parent().parent(),f=t.data("index"),u=r[f],e,v,l,h,a;if(s.find("i").parents("td").attr("class","detail"),e=null,t.next().is("tr.detail-view"))e=s.find("i"),e.attr("class")==="material-icons "+i.options.icons.detailOpen?(e.attr("class","material-icons "+i.options.icons.detailClose),t.next().css("display","table-row"),i.f_Trigger("collapse-row",f,u)):(e.attr("class","material-icons "+i.options.icons.detailOpen),t.next().css("display","none"),i.f_Trigger("expand-row",f,u,t.next().find("td")));else if(t.is("tr.detail-sub")){e=s.find("i");var y=t.attr("data-index"),o=t.next(),c=0;if(e.attr("class")==="material-icons "+i.options.icons.detailOpen){for(e.attr("class","material-icons "+i.options.icons.detailClose);o.attr("data-index")===y+"_"+c;)o.css("display","table-row"),o=o.next(),c++;i.f_Trigger("collapse-row",f,u)}else{for(e.attr("class","material-icons "+i.options.icons.detailOpen);o.attr("data-index")===y+"_"+c;)o.css("display","none"),o=o.next(),c++;i.f_Trigger("expand-row",f,u,t.next().find("td"))}}else{if(v="",i.options.detailShowOk&&i.options.detailShowCancel&&(v=['<div class="btns">',Cl_Core.f_Sprintf('<div class="btn"><button class="mdl-button mdl-js-button mdl-button--primary" type="button" name="bEdit">%s<\/button><\/div>',i.options.formatEdit()),"<\/div>"].join("")),s.find("i").attr("class","material-icons "+i.options.icons.detailClose),i.options.detailSub&&u.p_SubData!=null&&u.p_SubData.length>0)for(l=u.p_SubData.length-1;l>=0;l--)h=n(i.f_GetRowHtmlText(f,null,u.p_SubData,l)),h.addClass("detail-subItem"),t.after(h),t.addClass("detail-sub"),i.f_InitButtonsRows(h),i.f_InitRowsColors(h);else{t.after(Cl_Core.f_Sprintf('<tr class="detail-view"><td colspan="%s">%s%s<\/td><\/tr>',t.find("td").length,Cl_Core.f_CalculateObjectValue(i.options,i.options.detailFormatter,[f,u],""),v));a=t.next();a.find('button[name="bEdit"]').off("click").on("click",function(){f_Mdl_Dailog_Valid(a)&&Cl_Core.f_CalculateObjectValue(i.options,i.options.detailOkFunction,[f,u,a],null)})}i.f_Trigger("load-detail-view",f,u,t.next().find("td"))}i.f_ResetView()})};t.prototype.f_InitBody=function(t){var i=this,r=[],f=this.f_GetData(),u,e;for(this.f_Trigger("pre-body",f),this.$body=this.$el.find(">tbody"),this.$body.length||(this.$body=n("<tbody><\/tbody>").appendTo(this.$el)),this.$tableFooter=this.$el.find(">tfoot"),this.options.showFooter&&!this.$tableFooter.length&&(this.$tableFooter=n('<tfoot class="footerRow"><\/tfoot>').appendTo(this.$el)),this.el_TableBody=this.$body[0],this.pageFrom=1,this.pageTo=f.length,u=this.pageFrom-1;u<this.pageTo;u++)r.push(this.f_GetRowHtmlText(u));(this.data==null||this.data.length===0)&&(e=this.options.formatNoMatches(),r.push('<tr class="no-records-found">',Cl_Core.f_Sprintf('<td colspan="%s">%s<\/td>',this.$header.find("th").length,e),"<\/tr>"));this.$body.html(r.join(""));this.f_InitToolbarRows();this.f_InitButtonsRows();this.m_CardView&&i.options.cardTemplate!=null&&(n("div.mdl-table_row_panelCard",r).each(function(){i.f_Trigger("reset-item-cards",i,n(this),f[n(this).parents("tr").attr("data-index")])}),this.f_Trigger("reset-cards",this));t||this.f_ScrollTo(0);this.f_InitSelectColumns();this.f_InitDetail();this.f_InitChecked();this.f_InitRowsColors();n.each(this.header.events,function(t,r){var f,e,u;if(r){typeof r=="string"&&(r=Cl_Core.f_CalculateObjectValue(null,r));f=i.header.fields[t];e=n.inArray(f,i.getVisibleFields());(i.options.detailSub||i.options.detailView)&&!i.m_CardView&&(e+=1);for(u in r)i.$body.find(">tr:not(.no-records-found)").each(function(){var t=n(this),h=t.find(i.m_CardView?".card-view":"td").eq(e),o=u.indexOf(" "),s=u.substring(0,o),c=u.substring(o+1),l=r[u];h.find(c).off(s).on(s,function(n){var r=t.data("index"),u=i.data[r],e=u[f];l.apply(this,[n,e,u,r])})})}});this.f_UpdateSelected();this.f_ResetView();this.f_ResetTotals();this.f_Trigger("post-body")};t.prototype.f_InitServer=function(t,i,r){var u=this,f={},e={pageSize:this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,pageNumber:this.options.pageNumber,sortName:this.options.sortName,sortOrder:this.options.sortOrder},o;(this.options.url||this.options.ajax)&&(this.options.queryParamsType==="limit"&&(e={sort:e.sortName,order:e.sortOrder},e.limit=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,e.offset=this.options.pageSize===this.options.formatAllRows()?0:this.options.pageSize*(this.options.pageNumber-1)),n.isEmptyObject(this.filterColumnsPartial)||(e.filter=JSON.stringify(this.filterColumnsPartial,null)),f=Cl_Core.f_CalculateObjectValue(this.options,this.options.queryParams,[e],f),f.cmd=1,u.options.totalFields!==undefined&&(f.total=u.options.totalFields),n.extend(f,i||{}),f!==!1)&&(t||this.f_ShowLoading(),o=n.extend({},Cl_Core.f_CalculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:this.options.url,data:this.options.contentType==="application/json"&&this.options.method==="post"?JSON.stringify(f):f,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function(n){n.error!==undefined?(u.f_OnError(n.error),u.f_Trigger("load-error",n.status,n)):(n=Cl_Core.f_CalculateObjectValue(u.options,u.options.responseHandler,[n],n),u.f_Load(n),u.f_Trigger("load-success",n))},error:function(n){var t=n.responseText;t!==""?(t="Ошибка запроса!",u.f_ShowError(t)):u.f_ShowError(t);u.f_Trigger("load-error",n.status,n)},complete:function(n){r!==undefined&&r!==null&&r(n);u.f_HideLoading()}}),this.options.ajax?Cl_Core.f_CalculateObjectValue(this,this.options.ajax,[o],null):n.ajax(o))};t.prototype.f_UpdateCaret=function(){var t=this;n.each(this.$header.find("th"),function(i,r){n(r).find(".sortable").removeClass("desc asc").addClass(n(r).data("field")===t.options.sortName?t.options.sortOrder:"both")})};t.prototype.f_UpdateSelected=function(){var t,i;this.f_GetChecked()&&(t=this.$selectItem.filter(":enabled").filter(":checked").length,this.f_GetChecked()&&!this.options.singleSelect&&(i=this.$selectItem.filter(":enabled").length&&this.$selectItem.filter(":enabled").length===t,i?this.ctrl_SelectAll.check():this.ctrl_SelectAll.uncheck()),this.$selectItem.each(function(){n(this).closest("tr")[n(this).prop("checked")?"addClass":"removeClass"]("selected");n(this).prop("checked")?n(this).parent()[0].MaterialCheckbox.check():n(this).parent()[0].MaterialCheckbox.uncheck()}),t>0?(this.$toolbarSelectTitle.html(this.options.formatSelectRows()+": "+t),(this.options.showActionSelected||this.options.showRemoveSelected)&&this.$toolbarBActionSelected.prop("disabled",!1)):(this.$toolbarSelectTitle.html(""),(this.options.showActionSelected||this.options.showRemoveSelected)&&this.$toolbarBActionSelected.prop("disabled",!0)),this.f_GetTotals()&&this.options.totalIsChecked&&this.f_GetTotals()&&this.f_GetChecked()&&this.options.totalIsChecked&&this.f_ResetTotals())};t.prototype.updateRows=function(){var t=this;this.$selectItem.each(function(){t.data[n(this).data("index")][t.header.stateField]=n(this).prop("checked")})};t.prototype.resetRows=function(){var t=this;n.each(this.data,function(n,i){t.ctrl_SelectAll.uncheck();t.$selectItem.prop("checked",!1);t.header.stateField&&(i[t.header.stateField]=!1)})};t.prototype.f_ResetTotals=function(){var f,i,e,r,t,n,u,o,s;if(this.f_GetTotals())if(this.options.methodTotals!==undefined)Cl_Core.f_CalculateObjectValue(null,that.options.methodTotals,[that,this.dataTotals],"");else if(f=!1,i=undefined,this.f_GetTotals()&&this.f_GetChecked()&&this.options.totalIsChecked&&(f=!0,i=this.f_GetSelections()),this.dataTotals!==undefined||f)for(e=this.el_TableHeaderTotals.querySelectorAll(".totalSumVal"),r=0;r<e.length;r++)if(t=e[r].getAttribute("data-field"),t!==undefined&&t!==null&&t!==""){if(n=undefined,f&&i!==undefined)for(n=0,u=0;u<i.length;u++)o=parseFloat(this.f_GetValue(0,t,!1,!1,null,i[u]).toString().replace(" ","")),o!==undefined&&o!==i[u]&&(n+=o);else this.dataTotals!==undefined&&(n=this.dataTotals[t]);n!==undefined&&(s=this.f_GetColumnByField(t),s!==undefined&&(n=this.f_GetValueByType(s.type,n,!0)),e[r].innerHTML=n)}};t.prototype.f_ResetFooter=function(){var i,r;if(this.options.showFooter){var u=this,e=u.f_GetData(),t="",f=!1;Cl_Core.f_IsElementInView(this.$el,!0)?this.$tableFooter.removeClass("fixed"):(this.$tableFooter.addClass("fixed"),f=!0);this.options.footerFormatter!=null?t=Cl_Core.f_Sprintf('<td colspan="%s">%s<\/td>',255,Cl_Core.f_CalculateObjectValue(null,this.options.footerFormatter,[u,e],"")):this.m_CardView||(i=[],r=n("tr",this.$body),r.length>0&&n("td",r[0]).each(function(){i.push('<td style="',f?"width:"+this.offsetWidth+"px;":"",this.hidden||this.offsetWidth===0?"display: none;":"",'">&nbsp;<\/td > ')}),t=i.join(""));this.$tableFooter.html(t);clearTimeout(this.timeoutFooter_)}};t.prototype.getVisibleFields=function(){var t=this,i=[];return n.each(this.header.fields,function(n,r){var u=t.f_GetColumn(r);t.f_GetVisible(u)&&i.push(r)}),i};t.prototype.f_ResetView=function(){if(this.f_GetChecked()&&!this.options.singleSelect&&(this.$selectItem.length>0&&this.$selectItem.length===this.$selectItem.filter(":checked").length?this.ctrl_SelectAll.check():this.ctrl_SelectAll.uncheck()),this.options.showFooter&&this.f_ResetFooter(),this.m_CardView){this.$el.css("margin-top","0");return}this.f_UpdateCaret();this.f_Trigger("reset-view")};t.prototype.f_GetData=function(t){return!n.isEmptyObject(this.filterColumns)||!n.isEmptyObject(this.filterColumnsPartial)?t?this.data.slice(this.pageFrom-1,this.pageTo):this.data:t?this.options.data.slice(this.pageFrom-1,this.pageTo):this.options.data};t.prototype.f_Load=function(n){var t=!1;this.options.totalRows=n.total;t=n.fixedScroll;this.f_InitDataTotals(n[this.options.dataTotalsField]);this.f_InitData(n[this.options.dataField]);this.f_InitBody(t);this.f_UpdateDialogActionContent();this.m_IsLoaded=!0};t.prototype.f_GetDialogActionContent=function(t,i,r,u){var e=this,f=u,s="",o;return f==null&&i!=null&&(f=this.f_GetRowDataFromIndex(i)),f!=null&&(s=' data-key="'+f[this.options.key]+'"'),r==null&&(r=!1),o=Cl_Core.f_Sprintf('<div class="mdl-table mdl-table-dialog__content mdl-dialog__form"%s>',s),n.each(this.columns,function(n,u){var ut=!0,ot,c,y,p,s,h,w,b,k,it,rt,et;if(r||u.editingMethod===undefined||(ot=u.editingMethod,ut=Cl_Core.f_CalculateObjectValue(null,u.editingMethod,[e,f],"")),u.dialogVisibleAlways||ut&&u.dialogVisible&&(!u.readOnly||r)&&(!u.addOnly||i==null)&&(!u.editOnly||!r)&&u.type!=="button"&&(!u.hidden||r))if(u.editDialogContent!==undefined)o+='<div id="elDlgColumn_'+u.field+'"><\/div>';else{c="";(u.valRequired||u.type==="int"||u.type==="uint"||u.type==="money")&&(c=" required");u.valRegexPattern!=null?(c+=' pattern="'+u.valRegexPattern+'"',u.valRegexMsg!=null&&(c+=' patternmsg="'+u.valRegexMsg+'"')):u.type==="int"?c+=' pattern="-?[0-9]*(.[0-9]+)?"':u.type==="uint"?c+=' pattern="^\\d+$" min="0"':u.type==="money"&&(c+=' pattern="^\\d+(,\\d{1,2})?$" min="0"');(u.min!=null||u.max!=null)&&(u.min!=null&&(c+=' minlength="'+u.min+'"'),u.max!=null&&(c+=' maxlength="'+u.max+'"'));y="";p=e.f_GetFormatMask(u);y=p!==""?' data-mask="'+p+'" data-mask-clearifnotmatch="true"':"";var v=!1,a="",l="",ft="";if(u.readOnly||!e.options.showClone&&!e.options.showEdit&&e.options.editable&&e.m_CardView&&!u.editable||r?(v=!0,a=u.type==="bool"?" disabled":" disabled"):(v=!1,l=' field="'+u.field+'"',u.selectData!==undefined&&u.selectData!==null&&u.selectField!==undefined&&(ft=' fieldKey="'+u.selectField+'"')),s="",s=e.f_GetValue(i,u.field,v,!0,null,f),u.type==="money"&&(s=s.replace(/\s/g,"")),h=Cl_Core.f_Sprintf("dlg%s_%s_IField%s_%s",t,e.m_ID,i!=null?i:"-1",u.field),u.type==="hidden")o+=Cl_Core.f_Sprintf('<input type="hidden"%s id="%s" value="%s" />',l,h,s);else if(u.type==="bool")o+=[Cl_Core.f_Sprintf('<div class="field cbx%s">',u.cardColspan!=null?" width"+u.cardColspan:u.cardWidthfull?" full":""),Cl_Core.f_Sprintf('<label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="%s">',h),Cl_Core.f_Sprintf('<input%s type="checkbox" id="%s" class="mdl-checkbox__input"%s%s />',l,h,s?' checked="checked"':"",a),Cl_Core.f_Sprintf('<span class="mdl-checkbox__label">%s<\/span>',Cl_Core.f_GetPropertyFromOther(e.columns,"field","title",u.field)),"<\/label><\/div>"].join("");else if(u.type!=="date"&&u.type!=="datetime"||u.readOnly||r)if(u.type==="select")u.selectData!==undefined&&(w="",[].forEach.call(u.selectData,function(n,t){var r="",i="";u.selectDataType==="enum"?(r=t,i=n):(r=n[u.selectKey],i=n[u.selectValue]);w+='<li class="mdl-menu__item" key="'+r+'" value="'+i+'">'+i+"<\/li>"}),o+=[Cl_Core.f_Sprintf('<div class="field date%s">',u.colspan!=null?" width"+u.colspan:u.cardWidthfull?" full":""),Cl_Core.f_Sprintf('<div class="mdl-selectfield mdl-js-selectfield mdl-selectfield--floating-label"%s%s>',a,u.selectReadOnly?' data-read-only="true"':""),Cl_Core.f_Sprintf('<input%s%s id="%s" type="text" class="mdl-selectfield__input"%s%s />',l,ft,h,f!==undefined?' key="'+Cl_Core.f_GetItemField(f,u.selectField)+'"':"",c),Cl_Core.f_Sprintf('<label class="mdl-selectfield__label" for="%s">%s<\/label>',h,Cl_Core.f_GetPropertyFromOther(e.columns,"field","title",u.field)),Cl_Core.f_Sprintf('<ul for="%s">',h),w,"<\/ul>","<\/div><\/div>"].join(""));else if(u.type==="color")s==="-"&&(s="ffffff"),o+=Cl_Core.f_Sprintf('<input%s value="%s" class="jscolor {refine:false}"/><span>%s<\/span>',l,s,Cl_Core.f_GetPropertyFromOther(e.columns,"field","title",u.field));else if(v&&(u.fieldLink!==undefined&&u.fieldLink!==null&&u.fieldLink!==""||u.fieldLinkUrl!==undefined&&u.fieldLinkUrl!==null&&u.fieldLinkUrl!==""))b=u.fieldLink!=null&&u.fieldLink!==""?f[u.fieldLink]:e.f_GetTextFromTemplatyText(i,f,u.fieldLinkUrl),k="",k=b!==""?'<a target="_blank" href="'+b+'">'+s+"<\/a>":s,o+=[Cl_Core.f_Sprintf('<div class="field%s">',u.cardColspan!=null?" width"+u.cardColspan:u.cardWidthfull?" full":""),'<div class="'+t+' mdl-textfield mdl-textfield--floating-label is-dirty is-upgraded">',Cl_Core.f_Sprintf('<div class="mdl-textfield__input value">%s<\/div>',k),Cl_Core.f_Sprintf('<label class="mdl-textfield__label" for="%s">%s<\/label>',h,Cl_Core.f_GetPropertyFromOther(e.columns,"field","title",u.field)),"<\/div><\/div>"].join("");else{var d="text",g="",nt="",tt="";u.type==="number"||u.type==="int"||u.type==="uint"?(d="number",f!=null&&u.fieldMin!=null?(it=f[u.fieldMin],g=' min="'+it+'" minlength="'+it+'"'):u.min!=null&&(g=' min="'+u.min+'" minlength="'+u.min+'"'),f!=null&&u.fieldMax!=null?(rt=f[u.fieldMax],nt=' max="'+rt+'" maxlength="'+rt+'"'):u.max!=null&&(nt=' max="'+u.max+'" maxlength="'+u.max+'"'),f!=null&&u.fieldStep!=null?(et=f[u.fieldStep],tt=' step="'+et+'"'):u.step!=null&&(tt=' step="'+u.step+'"')):u.type==="password"?d="password":u.type==="array"&&(l+=' field-type="array"');o+=[Cl_Core.f_Sprintf('<div class="field%s">',u.cardColspan!=null?" width"+u.cardColspan:u.cardWidthfull?" full":""),'<div class="'+t+' mdl-textfield mdl-js-textfield mdl-textfield--floating-label">',u.cardArea==null?Cl_Core.f_Sprintf('<input%s class="mdl-textfield__input value" type="%s"%s%s%s id="%s" value="%s"%s%s%s />',l,d,g,nt,tt,h,s,c,y,a):Cl_Core.f_Sprintf('<textarea%s class="mdl-textfield__input value" type="text" id="%s" rows="%s"%s>%s<\/textarea>',l,h,u.cardArea,a,s),Cl_Core.f_Sprintf('<label class="mdl-textfield__label" for="%s">%s<\/label>',h,Cl_Core.f_GetPropertyFromOther(e.columns,"field","title",u.field)),u.valRegexMsg!=null?Cl_Core.f_Sprintf('<span class="mdl-textfield__error">%s<\/span>',u.valRegexMsg):"","<\/div><\/div>"].join("")}else o+=[Cl_Core.f_Sprintf('<div class="field date%s">',u.cardColspan!=null?" width"+u.cardColspan:u.cardWidthfull?" full":""),Cl_Core.f_Sprintf('<div class="mdl-datefield mdl-js-datefield mdl-datefield--floating-label"><input%s data-time="%s" id="%s" class="%s mdl-datefield__input" value="%s"%s><\/input>',l,u.type==="datetime"?"true":"false",h,u.field,s,c),Cl_Core.f_Sprintf('<label class="mdl-datefield__label" for="%s">%s<\/label>',h,Cl_Core.f_GetPropertyFromOther(e.columns,"field","title",u.field)),"<\/div><\/div>"].join("")}}),o+="<\/div>"};t.prototype.f_UpdateDialogActionContent=function(){var i=this,u=n(".mdl-table__dialog_action_open_"+i.m_ID),t=n(".mdl-dialog__content",u),f,r;t.length>0&&(f=n(".mdl-table-dialog__content",t).attr("data-key"),r=i.f_GetRowIndexFromKey(f),r!=null?(t.html(i.f_GetDialogActionContent("open",r,!0)),componentHandler.upgradeElements(t[0])):f_Mdl_Dailog_Hide(u))};t.prototype.f_GetDialogData=function(t,i){var r=this,u=t.f_GetData();return r.options.dataValues!==undefined&&r.options.dataValues!==null&&n.each(r.options.dataValues,function(n,t){u[t.field]=t.value}),r.options.dialogExtraFields!==null&&i!==undefined&&i!==null&&n.each(r.options.dialogExtraFields.split(","),function(n,t){u[t]=Cl_Core.f_GetItemField(i,t)}),u};t.prototype.f_Open=function(t,i){var r=this,u=i,s,h;u==null&&(u=r.f_GetRowIndex(t));var e=this.f_GetRowDataFromIndex(u),o="mdl-table__dialog_action_open_"+r.m_ID+"_"+u,f="";r.options.openTitleTemplate!=null&&(f=r.f_GetTextFromTemplatyText(u,e,r.options.openTitleTemplate));f.length>50&&(f=f.substring(0,50)+"...");s=n(r.f_GetBtnClone(u)+r.f_GetBtnEdit(u)+r.f_GetBtnRemove(u)+r.f_GetBtnUsers(u)+r.f_GetBtnDetailView(u));h=new MdlDialog({id:o,parentId:r.m_ID,classes:"mdl-table__dialog mdl-table__dialog_"+r.m_ID+" mdl-table__dialog_action_open_"+r.m_ID,title:f,isPage:!0,pageButtons$:s,readonly:!0,text:this.f_GetDialogActionContent("open",u,!0,e),positive:{title:this.options.formatOk()},onLoaded:function(){r.f_InitButtonsFromContent(this.pageButtons$);r.f_InitButtonsRows(this.pageButtons$,u,e);n.applyDataMask("#"+o+" "+n.jMaskGlobals.dataMaskAttr)}})};t.prototype.f_Review=function(t){var i=this,r="mdl-table__dialog_action_review_"+i.m_ID,u=new MdlDialog({id:r,parentId:i.m_ID,classes:"mdl-table__dialog mdl-table__dialog_"+i.m_ID,readonly:!0,text:this.f_GetDialogActionContent("review",this.f_GetRowIndexBtn(t),!0),positive:{title:this.options.formatOk()},onLoaded:function(){n.applyDataMask("#"+r+" "+n.jMaskGlobals.dataMaskAttr)}})};t.prototype.f_EditDialogContentInit=function(t){var i=this;n.each(i.columns,function(n,r){if(r.editDialogContent!==undefined){var u=document.getElementById("elDlgColumn_"+r.field);u!==undefined&&Cl_Core.f_CalculateObjectValue(null,r.editDialogContent,[i,u,t],"")}})};t.prototype.f_Add=function(){if(this.options.addLink!==undefined)window.open(this.options.addLink);else var t=this,i="mdl-table__dialog_action_add_"+t.m_ID,r=new MdlDialog({id:i,parentId:t.m_ID,classes:"mdl-table__dialog mdl-table__dialog_"+t.m_ID,text:t.options.addDialogContent!=null?Cl_Core.f_CalculateObjectValue(null,t.options.addDialogContent,[t],""):this.f_GetDialogActionContent("add"),negative:{title:this.options.formatCancel()},positive:{title:this.options.formatAdd(),onClick:function(){var i=null;t.options.addUrl!==undefined?i=t.f_GetDialogData(r):(i={},i.cmd="2",i.object=t.f_GetDialogData(r));t.options.addAction!=null?Cl_Core.f_CalculateObjectValue(null,t.options.addAction,[t,i],""):n.ajax({type:t.options.addMethod,url:t.options.addUrl!==undefined?t.options.addUrl:t.options.url,data:i,success:function(n){n.error!==undefined?t.f_OnError(n.error):t.f_Refresh()}})}},onLoaded:function(){n.applyDataMask("#"+i+" "+n.jMaskGlobals.dataMaskAttr);jscolor.installByClassName("jscolor");t.f_EditDialogContentInit()}})};t.prototype.f_Clone=function(t){var i=this,u=this.f_GetRowIndexBtn(t),r=this.f_GetRowDataFromIndex(u),f="mdl-table__dialog_action_clone_"+i.m_ID,e=new MdlDialog({id:f,parentId:i.m_ID,classes:"mdl-table__dialog mdl-table__dialog_"+i.m_ID,text:this.f_GetDialogActionContent("clone",u,!1,r),negative:{title:this.options.formatCancel()},positive:{title:this.options.formatClone(),onClick:function(){var t=null;i.options.addUrl!==undefined?t=i.f_GetDialogData(e,r):(t={},t.cmd="2",t.object=i.f_GetDialogData(e,r));i.options.addAction!=null?Cl_Core.f_CalculateObjectValue(null,i.options.addAction,[i,t],""):n.ajax({type:i.options.addMethod,url:i.options.addUrl!==undefined?i.options.addUrl:i.options.url,data:t,success:function(n){n.error!==undefined?i.f_OnError(n.error):i.f_Refresh()}})}},onLoaded:function(){n.applyDataMask("#"+f+" "+n.jMaskGlobals.dataMaskAttr);jscolor.installByClassName("jscolor");i.f_EditDialogContentInit(r)}})};t.prototype.f_Edit=function(t){var i=this,r=this.f_GetRowIndexBtn(t),f=this.f_GetRowDataFromIndex(r),e="mdl-table__dialog_action_edit_"+i.m_ID,u=new MdlDialog({id:e,parentId:i.m_ID,classes:"mdl-table__dialog mdl-table__dialog_"+i.m_ID,text:this.f_GetDialogActionContent("edit",r,!1,f),negative:{title:this.options.formatCancel()},positive:{title:this.options.formatEdit(),onClick:function(){var f=null,e=i.f_GetRowDataBtn(t);i.options.editUrl!==undefined?(f=i.f_GetDialogData(u,e),f[i.options.key]=e[i.options.key]):(f={},f.cmd="3",f.object=i.f_GetDialogData(u,e),f.object[i.options.key]=e[i.options.key]);i.options.editAction!=null?Cl_Core.f_CalculateObjectValue(null,i.options.editAction,[i,f],""):n.ajax({type:i.options.editMethod,url:i.options.editUrl!==undefined?i.options.editUrl:i.options.url,data:f,success:function(n){n.error!==undefined?i.f_OnError(n.error):i.options.editedUpdate?i.f_Refresh():i.f_UpdateRow(r,n)}})}},onLoaded:function(){n.applyDataMask("#"+e+" "+n.jMaskGlobals.dataMaskAttr);jscolor.installByClassName("jscolor");i.f_EditDialogContentInit(f);i.f_Trigger("dialog-edit-init",u)}})};t.prototype.f_Remove=function(t){var i=this,h=this.f_GetRowIndexBtn(t),u=this.f_GetRowDataFromIndex(h),s,r,o,e,f;if(this.options.removeAction!=null)Cl_Core.f_CalculateObjectValue(null,this.options.removeAction,[this,u],"");else if(s="",s=this.options.removeField!=null?this.options.formatConfirmRemoveWithField()+u[this.options.removeField]:this.options.formatConfirmRemove(),confirm(s)){if(r={},r.cmd=4,o=i.options.removeKey!=null?i.options.removeKey:i.options.key,i.options.removeUrl!==undefined?r[o]=u[o]:(r.keys=[],r.keys.push(u[o])),i.options.removeKeys!=null)for(e=i.options.removeKeys.split(","),f=0;f<e.length;f++)i.options.removeUrl!==undefined?r[e[f]]=Cl_Core.f_GetItemField(u,e[f]):r.keys.push(Cl_Core.f_GetItemField(u,e[f]));n.ajax({type:i.options.removeMethod,url:i.options.removeUrl!==undefined?i.options.removeUrl:i.options.url,data:r,success:function(n){n.error!==undefined?i.f_OnError(n.error):i.options.removedUpdate?i.f_Refresh():(i.f_DeleteRow(h),i.m_CardView&&i.f_HideAllDialogs())}})}};t.prototype.f_ActionSelected=function(){var i=this,e=this.options.key,u=this.f_GetSelections(),r=[],t,f;if(this.options.selectedArgumentIsKey)for(t=0;t<u.length;t++)r.push(u[t][e]);else for(t=0;t<u.length;t++)r.push(u[t]);(this.options.selectConfirm==null||this.options.selectConfirm===""||confirm(this.options.selectConfirm))&&(this.options.selectedAction!=null?Cl_Core.f_CalculateObjectValue(null,this.options.selectedAction,[this,r],""):(f={},f.keys=r,n.ajax({type:i.options.selectedActionMethod,url:i.options.selectedActionUrl,data:f,success:function(n){n.error!==undefined?i.f_OnError(n.error):(i.f_Refresh(),i.options.selectedActionEnd!=null&&Cl_Core.f_CalculateObjectValue(null,i.options.selectedActionEnd,[i,r],""))}})))};t.prototype.f_RemoveSelected=function(){var t=this,e=!1,i,r;if(e=this.options.removeSelectedAction!=null?!0:confirm(this.options.formatConfirmRemoves()),e){var o=this.options.key,u=this.f_GetSelections(),f=[],s=[];for(i=0;i<u.length;i++)f.push(u[i][o]),s.push(t.f_GetRowIndexFromKey(u[i][o]));this.options.removeSelectedAction!=null?Cl_Core.f_CalculateObjectValue(null,this.options.removeSelectedAction,[this,f],""):(r={},r.cmd=4,r.keys=f,n.ajax({type:t.options.removeSelected_Method,url:t.options.removeSelected_Url!==undefined?t.options.removeSelected_Url:t.options.url,data:r,success:function(n){n.error!==undefined?t.f_OnError(n.error):t.options.removedUpdate?t.f_Refresh():(t.f_DeleteRows(s),t.m_CardView&&t.f_HideAllDialogs())}}))}};t.prototype.f_SubDetail=function(t){var e=this.f_GetRowIndexBtn(t),r=this.f_GetRowDataFromIndex(e),u,s;if(r.p_SubData!=null&&r.p_SubData.length>0){var i=this,o="mdl-table__dialog_detail_sub_review"+i.m_ID,f='<div class="mdl-table"><table class="mdl-data-table cardView detailSubTable"><tbody>';for(u=0;u<r.p_SubData.length;u++)f+=i.f_GetRowHtmlText(e,null,r.p_SubData,u);f+="<\/tbody><\/table><\/div>";s=new MdlDialog({id:o,parentId:i.m_ID,classes:"mdl-table__dialog mdl-table__dialog_"+i.m_ID,text:f,positive:{title:this.options.formatOk()},onLoaded:function(){n("#"+o+" .detailSubTable").find("tbody > tr[data-index] > td").off("click dblclick").on("click dblclick",function(t){i.m_CardView&&i.options.cardReviewAuto&&n(t.target).parents('[name="bAction"]').length===0&&i.f_Open(t)});i.f_InitButtonsRows(s.m_dialog$)}})}};t.prototype.f_Detail=function(t){var o,s,h;if(this.options.detailFormatter!=null){var i=this,r=this.f_GetRowIndexBtn(t),u=this.f_GetRowDataFromIndex(r),f="mdl-table__dialog_detail_"+i.m_ID+"_"+i.options.key+"_"+u[i.options.key],e='<div class="mdl-table mdl-table-dialog__content mdl-dialog__form mdl-dialog__detail">';e+=Cl_Core.f_CalculateObjectValue(i.options,i.options.detailFormatter,[r,u],"");e+="<\/div>";o=null;s=null;i.options.detailShowOk&&(o={title:i.options.formatOk(),onClick:function(){Cl_Core.f_CalculateObjectValue(i.options,i.options.detailOkFunction,[r,u,n("#"+f+" .mdl-table-dialog__content")],null)}});i.options.detailShowCancel&&(s={title:i.options.formatCancel()});h=new MdlDialog({id:f,classes:"mdl-table__dialog mdl-table__dialog_"+i.m_ID+" mdl-table__dialog_detail",text:e,positive:o,negative:s,onLoaded:function(){i.f_Trigger("load-detail-view",r,u,n("#"+f+" .mdl-table-dialog__content"))}})}};t.prototype.f_HideAllDialogs=function(){f_Mdl_Dailog_Hide(n(".mdl-table__dialog_"+this.m_ID))};t.prototype.f_AddRow=function(t,i){var r,f,u;return this.data!=null?(r=this.data.length,this.data.splice(r,0,t),f=this.el_Table.querySelector("tbody"),u=document.createElement("tr"),u.setAttribute("data-index",r),f.appendChild(u),u.outerHTML=this.f_GetRowHtmlText(r,i),this.f_InitToolbarRows(),this.f_InitButtonsRows(n(u),r,t),this.$selectItem=this.$body.find(Cl_Core.f_Sprintf('[name="%s"]',this.options.selectItemName)),r):-1};t.prototype.f_AddNewRows=function(n){var i,u=0,f={},r,t,e;for([].forEach.call(this.header.fields,function(n){f[n]="_"}),r=-1,t=0;t<n;t++)e=this.f_AddRow(f,"mdl-table_empty"),t===0&&(r=e,i=this.el_Table.querySelector("tbody tr:last-child"),u=i.clientHeight),i.style.height=u*(n-t)+"px";return r};t.prototype.f_UpdateColumn=function(n,t,i){var e=this.data[n],u,r,f;e[t]=i;u=this.el_Table.querySelector('tbody tr[data-index="'+n+'"]');r=null;this.m_CardView?(r=this.options.cardTemplate==null?u.querySelector("td[fld="+t+"]"):u.querySelector("[fld="+t+"]"),r.innerHTML=this.f_GetValue(n,t,!0,!1,null,e)):(f=this.f_GetFieldIndex(this.columns,t),(this.options.detailSub||this.options.detailView)&&f++,this.f_GetChecked()&&f++,r=u.querySelector("td:nth-child("+(f+1)+")"),r.innerHTML=this.f_GetValue(n,t,!0,!1,null,e))};t.prototype.f_UpdateRow=function(t,i){var v=this,e,o,a,r,y,h,c,p,l;this.f_Trigger("pre-update-row",i);this.data[t]=i;var s=this.el_Table.querySelector('tbody tr[data-index="'+t+'"]'),f=null,u=0;if(this.m_CardView){for(f=this.options.cardTemplate==null?s.querySelectorAll("td[fld]"):s.querySelectorAll("[fld]"),u=0;u<f.length;u++)e=this.f_GetFieldIndex(this.columns,f[u].getAttribute("fld")),e>=0&&(f[u].innerHTML=this.f_GetValue(e,this.columns[e].field,!0,!1,null,i));this.f_InitSelectColumns(n(s))}else{for(f=s.querySelectorAll("td"),o=0,(this.options.detailSub||this.options.detailView)&&o++,this.options.numbering&&o++,this.f_GetChecked()&&(o++,f[0].innerHTML=this.f_GetColumnCheckedHtmlText(t,i),this.f_InitChecked(n(s))),a=0,u=0;u<this.header.fields.length;u++)r=this.columns[u],r.type==="hidden"?o--:r.type!=="button"?(r.fieldLink!=null&&r.fieldLink!==""||r.fieldLinkUrl!=null&&r.fieldLinkUrl!==""?(y=r.fieldLink!=null&&r.fieldLink!==""?this.f_GetValue(e,r.fieldLink,!0,!1,null,i):this.f_GetTextFromTemplatyText(e,i,r.fieldLinkUrl),f[u+o].innerHTML=Cl_Core.f_Sprintf('<a target="_blank" href="%s">%s<\/a>',y,this.f_GetValue(t,r.field,!0,!1,null,i))):f[u+o].innerHTML=this.f_GetValue(t,r.field,!0,!1,null,i),h="",(r.fieldTitle!==null&&r.fieldTitle!==""||r.fieldTitleTemplaty!=null&&r.fieldTitleTemplaty!=="")&&(h=r.fieldTitle!==null&&r.fieldTitle!==""?v.f_GetValue(e,r.fieldTitle,!0,!0,null,i):v.f_GetTextFromTemplatyText(e,i,r.fieldTitleTemplaty),(h==null||h==="-")&&(h="")),h!==""&&(f[u+o].title=h)):(f[f.length-1].children[a].innerHTML=this.f_GetValue(t,r.field,!0,!1,null,i),a++);c=s.querySelector("td.btnsRow");this.options.showClone&&(c.querySelector(".btnClone").outerHTML=this.f_GetBtnClone(t));this.options.showEdit&&(c.querySelector(".btnEdit").outerHTML=this.f_GetBtnEdit(t));this.options.showRemove&&(c.querySelector(".btnRemove").outerHTML=this.f_GetBtnRemove(t));this.options.showReview&&(p=c.querySelector(".btnReview"),p!==undefined&&(c.querySelector(".btnReview").outerHTML=this.f_GetBtnReview(t)))}l=n(s);l.removeClass("mdl-table_empty");this.f_InitDetail(l);this.f_InitButtonsRows(l,t,i);this.f_InitRowsColors(l);this.f_UpdateDialogActionContent();this.f_Trigger("update-row",this,t,l,i)};t.prototype.f_UpdateRows=function(n){var t=this,i;if(n==null)for(i=0;i<t.data.length;i++)t.f_UpdateRow(i,t.data[i]);else[].forEach.call(n,function(n){n.hasOwnProperty("index")&&n.hasOwnProperty("row")&&t.f_UpdateRow(n.index,n.row)});t.f_ResetFooter()};t.prototype.f_DeleteRow=function(t){var r=this.f_GetRowDataFromIndex(t),i;this.f_Trigger("pre-delete-row",r);this.data.splice(t,1);i=n('tbody tr[data-index="'+t+'"]',this.el_Table$);i.remove();this.f_ResetRowsIndexes()};t.prototype.f_DeleteRows=function(n){var i,t;if(n!==undefined)for(i=this,t=n.length-1;t>=0;t--)i.f_DeleteRow(n[t])};t.prototype.f_ShowError=function(n){this.options.showError&&alert(n)};t.prototype.f_Destroy=function(){this.$el.insertBefore(this.$container);n(this.options.toolbar).insertBefore(this.$el);this.$container.next().remove();this.$container.remove();this.$el.html(this.$el_.html()).css("margin-top","0").attr("class",this.$el_.attr("class")||"");window.removeEventListener("resize",this.e_OnWindowResize)};t.prototype.f_Refresh=function(n){var i,u,r,t;if(this.options.refreshAction!=null){if(i=this.options.refreshAction.match(/\(.*?\)/i),u=[this],i!=null&&i.length===1)for(r=i[0].replace(/\s|\(|\)/g,"").split(","),t=0;t<r.length;t++)r[t].length>0&&u.push(r[t].replace(/'|"/g,""));Cl_Core.f_CalculateObjectValue(null,this.options.refreshAction.replace(/\(.*?\)/i,""),u,"")}else n&&n.url&&(this.options.url=n.url);this.options.pageNumber=1;this.f_InitServer(n&&n.silent,n&&n.query)};t.prototype.f_ScrollTo=function(n){return typeof n=="string"&&(n=n==="bottom"?this.el_Container.scrollHeight:0),typeof n=="number"&&(this.el_Container.scrollTop=n),typeof n=="undefined"?this.el_Container.scrollTop:void 0};t.prototype.f_InitCardView=function(n){var t=this;this.m_CardView?this.el_Table.classList.add("cardView"):(this.el_Table.classList.remove("cardView"),this.f_HideAllDialogs());this.f_InitHeader();this.f_InitBody(n);this.m_CardView&&t.$body.find("[fld][data-hidding]").each(function(){var n=!0;t.m_HiddingFields[this.getAttribute("fld")]==null&&(t.m_HiddingFields[this.getAttribute("fld")]=this.getAttribute("data-hidding")==="true");n=t.m_HiddingFields[this.getAttribute("fld")];this.style.display=n?"none":""});this.f_Trigger("toggle",this.m_CardView)};t.prototype.expandRow_=function(n,t){var i=this.$body.find(Cl_Core.f_Sprintf('> tr[data-index="%s"]',t));i.next().is("tr.detail-view")===(n?!1:!0)&&i.find("> td > .detail-icon").click()};n(function(){n(".mdl-js-table").mdlTable()})}(jQuery);