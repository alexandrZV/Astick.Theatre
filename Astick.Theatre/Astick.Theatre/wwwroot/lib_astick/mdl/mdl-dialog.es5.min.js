"use strict";function MdlDialog(n){var t,u,f,e,o,v,y,h,p,w,s,b,k,i,r,c,l,a;n=$.extend({id:"mdl-dialog",parentId:null,classes:null,isPage:!1,title:null,text:null,buttons:undefined,pageButtons$:null,negative:!1,positive:!1,buttonDop:!1,cancelable:!0,contentStyle:null,onLoaded:!1,onBack:!1,readonly:!1,autoSize:!1},n);this.m_dialog$;this.options=n;this.m_ID=n.id;this.m_PageUrl=window.location.href;this.m_PageTitle=n.title!=null?n.title:document.title;this.m_Index=0;t=this;u="";n.classes!=null&&(u=" "+n.classes);$("#"+n.id).remove();$(document).unbind("keyup.dialog");f="";n.readonly&&(f=" mdl-dialog_readonly");e="";n.autoSize&&(e=" mdl-dialog_autosize");o="";n.parentId!=null&&(o=' data-parentId="'+n.parentId+'"');v=function(){var t=document.querySelector(".mdl-dialog:last-child > div"),n;t!=null&&(n=$(t).data("mdl.dialog"),n!=null&&this==n&&(window.history.pushState(m_DialogHistoryState+"_"+window.history.state,this.m_PageTitle,this.m_PageUrl),this.f_Hide()))};window.history&&(this.e_OnPopState=v.bind(this),window.addEventListener("popstate",this.e_OnPopState,!1),y=document.querySelectorAll(".mdl-dialog > div"),this.m_Index=y.length,this.m_Index==0?window.history.replaceState(m_DialogHistoryState+"_"+window.history.state,this.m_PageTitle,this.m_PageUrl):window.history.replaceState(window.history.state,this.m_PageTitle,this.m_PageUrl),window.history.m_Blocking=!0);n.isPage?(h="",n.title!=null&&(h=n.title),p=document.body.scrollTop,f_Mdl_Dialog_HideBody(),$('<div class="mdl-dialog'+f+e+'"'+o+'><div id="'+n.id+'" class="mdl-dialog-page'+u+'" data-scrollY="'+p+'" data-index="'+this.m_Index+'"><div class="mdl-layout__container"><\/div><\/div><\/div>').appendTo("body"),this.m_dialog$=$("#"+n.id),this.m_dialog$.data("mdl.dialog",this),w=this.m_dialog$.find(".mdl-layout__container"),s=$('<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header"><header class="mdl-layout__header"><div class="mdl-layout__header-row"><button class="mdl-button mdl-js-button mdl-button--icon bPrev"><i class="material-icons">arrow_back<\/i><\/button><span class="mdl-layout-title flex">'+h+'<\/span><div class="mdl-dialog-page-btns"><\/div><\/div><\/header><main class="mdl-layout__content"><div class="mdl-dialog__content">'+n.text+"<\/div><\/main><\/div>"),s.appendTo(w),b=s.find(".bPrev"),b.click(function(i){n.onBack?n.onBack(t.m_dialog$)&&(i.preventDefault(),t.f_Hide()):(i.preventDefault(),t.f_Hide())}),n.pageButtons$!=null&&(k=s.find(".mdl-dialog-page-btns"),n.pageButtons$.appendTo(k)),componentHandler.upgradeElements(this.m_dialog$[0])):($('<div class="mdl-dialog'+f+e+'"'+o+'><div id="'+n.id+'" class="mdl-dialog-container'+u+'"><div class="mdl-card mdl-shadow--16dp" data-index="'+this.m_Index+'"><\/div><\/div><\/div>').appendTo("body"),this.m_dialog$=$("#"+n.id),this.m_dialog$.data("mdl.dialog",this),i=this.m_dialog$.find(".mdl-card"),n.contentStyle!=null&&i.css(n.contentStyle),n.title!=null&&$('<h5 class="mdl-dialog__title">'+n.title+"<\/h5>").appendTo(i),n.text!=null&&$('<div class="mdl-dialog__content">'+n.text+"<\/div>").appendTo(i),(n.negative||n.positive)&&(r=$('<div class="mdl-dialog__actions"><\/div>'),n.negative&&(n.negative=$.extend({id:"negative",title:"Cancel",onClick:function(){return!1}},n.negative),c=$('<button class="mdl-button mdl-js-button mdl-js-ripple-effect" id="'+n.negative.id+'">'+n.negative.title+"<\/button>"),c.click(function(i){i.preventDefault();n.negative.onClick(i)||t.f_Hide()}),c.appendTo(r)),n.positive&&(n.positive=$.extend({id:"positive",title:"OK",onClick:function(){return!1}},n.positive),l=$('<button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="'+n.positive.id+'">'+n.positive.title+"<\/button>"),l.click(function(i){i.preventDefault();f_Mdl_Dailog_Valid(t.m_dialog$)&&(n.positive.onClick(i)||t.f_Hide())}),l.appendTo(r)),n.buttonDop&&(n.buttonDop=$.extend({id:"buttonDop",title:"Dop",onClick:function(){return!1}},n.buttonDop),a=$('<button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="'+n.buttonDop.id+'">'+n.buttonDop.title+"<\/button>"),a.click(function(i){i.preventDefault();n.buttonDop.onClick(i)||t.f_Hide()}),a.appendTo(r)),r.appendTo(i)),componentHandler.upgradeElements(i[0]),n.cancelable&&(this.m_dialog$.click(function(){t.f_Hide()}),$(document).bind("keyup.dialog",function(n){n.which==27&&t.f_Hide()}),i.click(function(n){n.stopPropagation()})));setTimeout(function(){if(t.m_dialog$.css({opacity:1}),n.onLoaded)n.onLoaded(t.m_dialog$);$("input",t.m_dialog$).each(function(){var n=$(this),i=n.attr("data-type"),t="",r=n.next();r!=null&&r.is("label")&&(t=r.html());i=="real"?(n.attr("pattern","^d+$"),n.attr("min","1"),n.attr("patternmsg",'Поле "'+t+'" должно быть больше 0!')):i=="uint"?(n.attr("pattern","^d+$"),n.attr("min","0"),n.attr("patternmsg",'Поле "'+t+'" должно быть положительным числом!')):i=="int"&&(n.attr("pattern","^d+$"),n.attr("patternmsg",'Поле "'+t+'" должно быть числом!'))})},1);this.f_Valid=function(){return f_Mdl_Dailog_Valid(this.m_dialog$)};this.f_GetData=function(){return f_Mdl_Dailog_GetData(this.m_dialog$)};this.f_Hide=function(){var n=this,t=document.querySelectorAll(".mdl-dialog > div");[].forEach.call(t,function(t){var i=$(t).data("mdl.dialog");if(i!=null&&n.m_Index<i.m_Index){i.f_Hide();return}});t.length<=1&&(window.history.replaceState(window.history.state.replace(m_DialogHistoryState+"_",""),this.m_PageTitle,this.m_PageUrl),window.history.m_Blocking=!1);window.removeEventListener("popstate",this.e_OnPopState);$(document).unbind("keyup.dialog");setTimeout(function(){n.m_dialog$.parent().remove();var t=$(".mdl-dialog:last");t.length>0?t.removeClass("mdl-dialog-bodyHide"):$("body").children().each(function(){$(this).removeClass("mdl-dialog-bodyHide")});document.body.scrollTop=parseInt(n.m_dialog$.attr("data-scrollY"))},100)}}function f_Mdl_Dialog_HideBody(){$("body").children().each(function(){$(this).addClass("mdl-dialog-bodyHide")})}function f_Mdl_Dialog_ShowBody(){$("body").children().each(function(){$(this).addClass("mdl-dialog-bodyHide")})}function f_Mdl_Dailog_Hide(n){if(n!=null){var t=n.data("mdl.dialog");t!=null&&t.f_Hide()}}function f_Mdl_Dailog_Valid(n){var t=$(":visible.is-invalid",n);return t.length>0?($("input",t[0]).each(function(){var n=$(this),t=n.parent().find("label");if(t!=null&&t.is("label")){if(n.attr("type")==="number"||n.attr("data-type")==="uint")return alert('Неправильно заполнено поле "'+t.html()+'". '+(n[0].validationMessage!==undefined?n[0].validationMessage:"")),!1;if(n.attr("pattern")!=null)return n.attr("required")!=null&&n.val()==""?(alert('Необходимо заполнить поле "'+t.html()+'"'),!1):n.attr("patternmsg")!=null?(alert(n.attr("patternmsg")),!1):(alert('Неправильно заполнено поле "'+t.html()+'"'),!1);if(n.attr("required")!=null)return alert('Необходимо заполнить поле "'+t.html()+'"'),!1}}),!1):!0}function f_Mdl_Dailog_GetData(n){var t={};return $('[field]:visible,[field][type="hidden"]',n).each(function(){t[$(this).attr("field")]=this.type=="checkbox"?this.checked:$(this).attr("field-type")==="array"?this.value.replace(/(?:\r\n|\r|\n)/g,", "):$(this).val();$(this).attr("key")!=null&&$(this).attr("fieldKey")!=null&&(t[$(this).attr("fieldKey")]=$(this).attr("key"))}),$('[name]:visible,[name][type="hidden"]',n).each(function(){this.type=="checkbox"?t[$(this).attr("name")]=this.checked:this.type=="radio"?this.checked&&(t[$(this).attr("name")]=this.value):t[$(this).attr("name")]=$(this).attr("field-type")==="array"?this.value.replace(/(?:\r\n|\r|\n)/g,", "):$(this).val()}),t}var m_DialogHistoryState="mdldialog";window.history.state!=null&&window.history.state!=""&&window.history.replaceState(window.history.state.replace(m_DialogHistoryState+"_",""),null,null);