"use strict";!function(n){n.extend(n.fn.mdlTable.defaults,{infiniteScroll:!0,pageSize:15});var t=n.fn.mdlTable.Constructor,i=t.prototype.f_Init,r=t.prototype.f_InitServer,u=t.prototype.f_Refresh;t.prototype.f_Init=function(){if(!this.options.infiniteScroll||!this.options.url&&!this.options.ajax){i.apply(this,Array.prototype.slice.apply(arguments));return}this.options.showFooter=!1;i.apply(this,Array.prototype.slice.apply(arguments));var n=this,t=0,u=0,f=0,o=0,s=0,h=this.options.pageSize,r=0,e=document.querySelector(".mdl-layout__content");e==null&&(e=window);e.addEventListener("scroll",function(i){var e=this,l,a,v,c,y;e===window&&(e=document.body);u<e.scrollTop&&(t=Math.ceil(e.scrollHeight/4),r>0&&(l=r*n.options.pageSize,t>l&&(t=l)),s>i.timeStamp-200?(f+=e.scrollTop-u,o++):(f=0,o=0),e.scrollHeight-e.scrollTop<=e.clientHeight+t&&n.data.length<n.options.totalRows&&(a=n.el_Table.querySelector("tbody tr"),r=a.clientHeight,v=Math.ceil(f/r),c=Math.ceil(v/n.options.totalRows*n.options.pageSize+n.options.pageSize),c<h&&(c=h),n.data.length+c>n.options.totalRows&&(c=n.options.totalRows-n.data.length),y=n.f_AddNewRows(c),n.options.pageNumber++,n.f_InitServer(null,null,null,y,c)),s=i.timeStamp);u=e.scrollTop})};t.prototype.f_InitServer=function(t,i,u,f,e){if(!this.options.infiniteScroll){r.apply(this,Array.prototype.slice.apply(arguments));return}if(this.options.url||this.options.ajax){var o=this,s={},h={sort:this.options.sortName,order:this.options.sortOrder,limit:e!==undefined?e:this.options.pageSize,offset:f!=null?f:0},c;(o.options.pageNumber==1&&(h.limit=this.options.pageSize*3),n.isEmptyObject(this.filterColumnsPartial)||(h.filter=JSON.stringify(this.filterColumnsPartial,null)),s=n.fn.mdlTable.utils.calculateObjectValue(this.options,this.options.queryParams,[h],s),s.cmd=1,n.extend(s,i||{}),s!==!1)&&(t||this.f_ShowLoading(),c=n.extend({},n.fn.mdlTable.utils.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:this.options.url,data:this.options.contentType==="application/json"&&this.options.method==="post"?JSON.stringify(s):s,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function(t){var u,i,r;if(t.error!==undefined)o.f_OnError(t.error),o.f_Trigger("load-error",t.status,t);else{if(t=n.fn.mdlTable.utils.calculateObjectValue(o.options,o.options.responseHandler,[t],t),t.total!=null&&t.total>0)if(o.options.pageNumber==1)o.f_Load(t);else{for(u=[],i=0;i<t.rows.length;i++)r={},r.index=h.offset+i,r.row=t.rows[i],u.push(r);o.f_UpdateRows(u)}else o.f_Load(t);o.f_Trigger("load-success",t)}},error:function(n){var t=n.responseText;t!==""?(t="Ошибка запроса!",o.f_ShowError(t)):o.f_ShowError(t);o.f_Trigger("load-error",n.status,n)},complete:function(n){u!==undefined&&u!==null&&u(n);o.f_HideLoading()}}),this.options.ajax?n.fn.mdlTable.utils.calculateObjectValue(this,this.options.ajax,[c],null):n.ajax(c))}};t.prototype.f_Refresh=function(n){if(!this.options.infiniteScroll||!this.options.url&&!this.options.ajax){u.apply(this,Array.prototype.slice.apply(arguments));return}n&&n.url&&(this.options.url=n.url);this.options.pageNumber=1;this.f_InitServer(n&&n.silent,n&&n.query,null)}}(jQuery);