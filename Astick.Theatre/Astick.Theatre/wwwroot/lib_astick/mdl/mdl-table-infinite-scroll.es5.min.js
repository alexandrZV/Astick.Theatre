"use strict";!function(n){n.extend(n.fn.mdlTable.defaults,{infiniteScroll:!0,pageFixedSize:!1,pageSize:15});var t=n.fn.mdlTable.Constructor,i=t.prototype.f_Init,r=t.prototype.f_InitServer,u=t.prototype.f_Refresh;t.prototype.f_Init=function(){if(!this.options.infiniteScroll||!this.options.url&&!this.options.ajax){i.apply(this,Array.prototype.slice.apply(arguments));return}i.apply(this,Array.prototype.slice.apply(arguments));var n=this,t=0,f=0,e=0,o=0,s=0,h=this.options.pageSize,r=0,u=document.querySelector(".mdl-layout__content");(u===null||u===undefined)&&(u=window);u.addEventListener("scroll",function(i){var c=this,l=c.scrollTop,v,y,u,a,p;c===window&&(c=document.body,l=window.pageYOffset);f<l&&(t=Math.ceil(c.scrollHeight/4),r>0&&(v=r*n.options.pageSize,t>v&&(t=v)),s>i.timeStamp-200?(e+=l-f,o++):(e=0,o=0),c.scrollHeight-l<=c.clientHeight+t&&n.data.length<n.options.totalRows&&(y=n.el_Table.querySelector("tbody tr"),r=y.clientHeight,u=0,a=0,n.options.pageFixedSize?(u=n.options.pageSize,a=n.f_AddNewRows(u)/n.options.pageSize):(p=Math.ceil(e/r),u=Math.ceil(p/n.options.totalRows*n.options.pageSize+n.options.pageSize),u<h&&(u=h),n.data.length+u>n.options.totalRows&&(u=n.options.totalRows-n.data.length),a=n.f_AddNewRows(u)),n.options.pageNumber++,n.f_InitServer(null,null,null,a,u)),s=i.timeStamp);f=l})};t.prototype.f_InitServer=function(t,i,u,f,e){if(!this.options.infiniteScroll){r.apply(this,Array.prototype.slice.apply(arguments));return}if(this.options.url||this.options.ajax){var o=this,h={},s={sort:this.options.sortName,order:this.options.sortOrder},c;(o.options.pageFixedSize?(s.pageindex=f!==undefined?f:0,s.pagesize=this.options.pageSize):(s.offset=f!==undefined?f:0,s.limit=o.options.pageNumber===1?this.options.pageSize*3:e!==undefined?e:this.options.pageSize),n.isEmptyObject(this.filterColumnsPartial)||(s.filter=JSON.stringify(this.filterColumnsPartial,null)),h=n.fn.mdlTable.utils.calculateObjectValue(this.options,this.options.queryParams,[s],h),h.cmd=1,o.options.totalFields!==undefined&&(h.total=o.options.totalFields),n.extend(h,i||{}),h!==!1)&&(t||this.f_ShowLoading(),c=n.extend({},n.fn.mdlTable.utils.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:this.options.url,data:this.options.contentType==="application/json"&&this.options.method==="post"?JSON.stringify(h):h,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function(t){var u,i,r;if(t.error!==undefined)o.f_OnError(t.error),o.f_Trigger("load-error",t.status,t);else{if(t=n.fn.mdlTable.utils.calculateObjectValue(o.options,o.options.responseHandler,[t],t),(t.total!==null||t.total!==undefined)&&t.total>0)if(o.options.pageNumber===1)o.f_Load(t);else{for(u=[],i=0;i<t.rows.length;i++)r={},r.index=o.options.pageFixedSize?s.pageindex*s.pagesize+i:s.offset+i,r.row=t.rows[i],u.push(r);o.f_UpdateRows(u)}else o.f_Load(t);o.f_Trigger("load-success",t)}},error:function(n){var t=n.responseText;t!==""?(t="Ошибка запроса!",o.f_ShowError(t)):o.f_ShowError(t);o.f_Trigger("load-error",n.status,n)},complete:function(n){u!==undefined&&u!==null&&u(n);o.f_HideLoading()}}),this.options.ajax?n.fn.mdlTable.utils.calculateObjectValue(this,this.options.ajax,[c],null):n.ajax(c))}};t.prototype.f_Refresh=function(n){if(!this.options.infiniteScroll||!this.options.url&&!this.options.ajax){u.apply(this,Array.prototype.slice.apply(arguments));return}n&&n.url&&(this.options.url=n.url);this.options.pageNumber=1;this.f_InitServer(n&&n.silent,n&&n.query,null)}}(jQuery);