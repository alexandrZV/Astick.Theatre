<page-info title="Управление ценами" />
@using Astick.Shop.Core.Products.Providers
@model I_Provider[]

<script type="text/javascript">
	var m_TableRates;
	$(document).ready(function () {
		m_TableRates = $('#tableRates').mdlTable().data('mdl.table');
		var cbPrds = new MaterialSelectfield(document.getElementById('cbPrds'));
		//cbPrds.f_SetIndex(0);
		f_LoadRates();
	});
	function f_LoadRates(a_ProviderName) {
		var providerName = a_ProviderName;
		if (providerName === undefined) {
			providerName = '';
		}
		$('#params').waitMe();
		$.ajax({
			type: "POST",
			url: "/admin/prices/f_GetRates",
			data: { a_ProviderName: a_ProviderName },
			success: function (data, textStatus) {
				m_TableRates.f_Load(data);
				m_TableRates.options.dataValues = [{ field: 'p_ProviderName', value: a_ProviderName }];
			}
		});
		return true;
	}
	function f_RefreshRates() {
		f_LoadRates(m_TableRates.options.dataValues[0].value);
	}
</script>

<section class="content">
	<div class="prices">
		@if (Model != null && Model.Length > 0) {
		<div class="cat_Providers">
			<div id="cbPrds" class="mdl-selectfield mdl-selectfield--floating-label" data-read-only="true" style="min-width: 200px;">
				<input id="cat_Providers" class="mdl-selectfield__input" type="text" placeholder="По умолчанию для всех" />
				<label class="mdl-selectfield__label" for="cat_Providers">Поставщик</label>
				<ul for="cat_Providers">
					<li class="mdl-menu__item mdl-menu__item--full-bleed-divider" onclick="f_LoadRates('')" key="all">По умолчанию для всех</li>
					@foreach (I_Provider prd in Model) {
					<li class="mdl-menu__item mdl-menu__item--full-bleed-divider" onclick="f_LoadRates('@prd.p_Name')" key="@prd.p_Name">@prd.p_Name</li>
					}
				</ul>
			</div>
		</div>
		<div class="rates">
			<table id="tableRates" data-locale="ru-RU"
						 data-key="p_RateID"
						 data-refresh-action="f_RefreshRates"
						 data-show-add="true"
						 data-add-url="/Admin/Prices/f_AddRate"
						 data-show-edit="true"
						 data-edit-url="/Admin/Prices/f_UpdateRate"
						 data-show-remove="true"
						 data-remove-url="/Admin/Prices/f_DeleteRate"
						 data-show-remove-selected="true"
						 data-remove-selected_-url="/Admin/Prices/f_DeleteRates"
						 data-show-refresh="true">
				<thead>
					<tr>
						<th data-field="p_Sum" data-type="money" data-sortable="true" data-align="center">Стоимость, руб</th>
						<th data-field="p_Rate" data-type="uint" data-align="center" data-min="0" data-max="1000" data-val-regex-msg="Необходимо ввести целое число от 0 до 1000!" data-val-regex-pattern="^\d{1,3}|1000$">Ставка, %</th>
					</tr>
				</thead>
			</table>
		</div>
		} else {
		<h6>Поставщики отсутствуют!</h6>
		}
	</div>
</section>